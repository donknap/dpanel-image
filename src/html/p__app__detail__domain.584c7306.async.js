"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3146],{80821:function(le,M,t){t.d(M,{Z:function(){return w}});var z=t(5574),E=t.n(z),W=t(93246),j=t(54006),G=t(31418),b=t(86738),g=t(14726),Y=t(83062),O=t(62435),I=t(86074);function w(a){var N=(0,O.useState)(!1),U=E()(N,2),P=U[0],K=U[1],$=G.Z.useApp(),k=(0,j.useIntl)(),L=function(){K(!0),a.action().then(function(y){if(K(!1),typeof a.onSuccess=="function"&&a.onSuccess(y),a.messageSuccess){var D="";a.messageSuccess.indexOf(".")>-1?D=k.formatMessage({id:a.messageSuccess}):D=a.messageSuccess,a.asynced?(0,W.Rk)($,D):(0,W.$h)($,D)}}).catch(function(y){K(!1),typeof a.onError=="function"&&a.onError(y)})};return a.confirm?(0,I.jsx)(b.Z,{style:{width:500},title:"\u63D0\u793A",description:a.confirm,onConfirm:L,okText:"Yes",cancelText:"No",children:(0,I.jsx)(g.ZP,{disabled:a.disabled,icon:a.icon,loading:P,danger:a.danger,type:a.type,children:a.children})}):(0,I.jsx)(Y.Z,{title:a.tips,children:(0,I.jsx)(g.ZP,{disabled:a.disabled,icon:a.icon,loading:P,onClick:L,danger:a.danger,type:a.type,children:a.children})})}},71457:function(le,M,t){t.r(M),t.d(M,{default:function(){return xe}});var z=t(15009),E=t.n(z),W=t(99289),j=t.n(W),G=t(5574),b=t.n(G),g=t(54006);function Y(s){return O.apply(this,arguments)}function O(){return O=j()(E()().mark(function s(l){return E()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,g.request)("/api/app/site/get-domain-list",{method:"POST",data:l}));case 1:case"end":return n.stop()}},s)})),O.apply(this,arguments)}function I(s){return w.apply(this,arguments)}function w(){return w=j()(E()().mark(function s(l){return E()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,g.request)("/api/app/site/create-domain",{method:"POST",data:l}));case 1:case"end":return n.stop()}},s)})),w.apply(this,arguments)}function a(s){return N.apply(this,arguments)}function N(){return N=j()(E()().mark(function s(l){return E()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,g.request)("/api/app/site/delete-domain",{method:"POST",data:l}));case 1:case"end":return n.stop()}},s)})),N.apply(this,arguments)}function U(s){return P.apply(this,arguments)}function P(){return P=j()(E()().mark(function s(l){return E()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,g.request)("/api/app/site/get-domain-detail",{method:"POST",data:l}));case 1:case"end":return n.stop()}},s)})),P.apply(this,arguments)}function K(s){return $.apply(this,arguments)}function $(){return $=j()(E()().mark(function s(l){return E()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,g.request)("/api/app/site/apply-domain-cert",{method:"POST",data:l}));case 1:case"end":return n.stop()}},s)})),$.apply(this,arguments)}var k=t(184),L=t(90672),H=t(5966),y=t(62370),D=t(52688),re=t(92398),ie=t(38925),oe=t(34041),J=t(71230),T=t(15746),F=t(62435),V=t(20713),e=t(86074),Q="",de=(0,F.forwardRef)(function(s,l){var A=(0,F.useState)(!1),n=b()(A,2),C=n[0],o=n[1],r=(0,F.useRef)(),h=(0,F.useState)(),d=b()(h,2),u=d[0],c=d[1],B=(0,g.useModel)("subscriber"),i=(0,F.useState)(!1),f=b()(i,2),p=f[0],R=f[1];return(0,F.useImperativeHandle)(l,function(){return{showEdit:function(m){var v,Z;(v=r.current)===null||v===void 0||v.setFieldsValue({sslCrt:m.setting.sslCrt,sslKey:m.setting.sslKey,email:(Z=localStorage.getItem("email"))!==null&&Z!==void 0?Z:"",console:""}),m.setting.autoSsl&&R(!0),Q="",c(m),o(!0)}}}),B.addDataHandler("composeUp",function(){var S=B.getDataByType("composeUp");if(S){var m;S.map(function(v){Q+=v.data}),(m=r.current)===null||m===void 0||m.setFieldValue("console",Q)}}),(0,e.jsx)(k.a,{drawerProps:{forceRender:!0},formRef:r,onFinish:function(){var S=j()(E()().mark(function m(v){var Z,X,q,_,ee,te,ne,ue,De,Ae;return E()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(u){x.next=2;break}return x.abrupt("return",!0);case 2:if(!(v.sslCrt&&v.sslKey&&!u.setting.autoSsl)){x.next=7;break}return x.next=5,I({id:u.id,containerId:u.containerId,serverName:u.serverName,port:(Z=u.setting.port)!==null&&Z!==void 0?Z:80,enableBlockCommonExploits:(X=u.setting.enableBlockCommonExploits)!==null&&X!==void 0?X:!1,enableAssetCache:(q=u.setting.enableAssetCache)!==null&&q!==void 0?q:!1,enableWs:(_=u.setting.enableWs)!==null&&_!==void 0?_:!1,extraNginx:(ee=u.setting.extraNginx)!==null&&ee!==void 0?ee:"",sslCrt:(te=v.sslCrt)!==null&&te!==void 0?te:"",sslKey:(ne=v.sslKey)!==null&&ne!==void 0?ne:""});case 5:De=x.sent,(ue=r.current)===null||ue===void 0||ue.resetFields();case 7:if(!(v.email&&u.id)){x.next=12;break}return localStorage.setItem("email",v.email),x.next=11,K({id:u.id,email:v.email,certServer:v.certServer,autoUpgrade:v.autoUpgrade,renew:v.renew,debug:v.debug});case 11:Ae=x.sent;case 12:return s.onFinish&&s.onFinish(),x.abrupt("return",!0);case 14:case"end":return x.stop()}},m)}));return function(m){return S.apply(this,arguments)}}(),onOpenChange:function(m){o(m)},open:C,children:(0,e.jsx)(re.Z,{items:[{key:"1",label:"\u5F53\u524D\u8BC1\u4E66",children:(0,e.jsxs)(e.Fragment,{children:[p&&(0,e.jsx)(ie.Z,{message:"\u5F53\u524D\u8BC1\u4E66\u4E3A\u81EA\u52A8\u7B7E\u53D1\uFF0C\u8BF7\u52FF\u4FEE\u6539\u3002\u8BC1\u4E66\u8DEF\u5F84\u4E3A\uFF1A/dpanel/cert \u76EE\u5F55",style:{margin:"15px 0"}}),(0,e.jsx)(L.Z,{fieldProps:{autoSize:{minRows:10}},label:"\u8BC1\u4E66\u5185\u5BB9 .crt ",name:"sslCrt",tooltip:"1.\u901A\u5E38\u8BC1\u4E66\u662F\u4EE5 .crt \u6216 .pem \u7B49\u4E3A\u6269\u5C55\u540D\u7684\u6587\u4EF6\uFF0C\u8BF7\u4F7F\u7528\u76F8\u5E94\u6587\u672C\u7F16\u8F91\u5668\u6253\u5F00\u8BC1\u4E66\u6587\u4EF6\u3002 2.\u8BC1\u4E66\u683C\u5F0F\u4EE5\u201C-----BEGIN CERTIFICATE-----\u201D\u5F00\u5934\uFF0C\u4EE5\u201C-----END CERTIFICATE-----\u201D\u7ED3\u5C3E\u3002 3.\u8BC1\u4E66\u5185\u5BB9\u8BF7\u5305\u542B\u5B8C\u6574\u7684\u8BC1\u4E66\u94FE\u3002",placeholder:"-----BEGIN CERTIFICATE-----",disabled:p},"sslCrt"),(0,e.jsx)(L.Z,{fieldProps:{autoSize:{minRows:10}},label:"\u79C1\u94A5\u5185\u5BB9 .key ",name:"sslKey",tooltip:"1.\u901A\u5E38\u79C1\u94A5\u662F\u4EE5 .key \u6216 .pem \u7B49\u4E3A\u6269\u5C55\u540D\u7684\u6587\u4EF6\uFF0C\u8BF7\u4F7F\u7528\u76F8\u5E94\u6587\u672C\u7F16\u8F91\u5668\u6253\u5F00\u79C1\u94A5\u6587\u4EF6\u3002 2.\u79C1\u94A5\u683C\u5F0F\u4EE5\u201C-----BEGIN PRIVATE KEY-----\u201D\u5F00\u5934\uFF0C\u4EE5\u201C-----END PRIVATE KEY-----\u201D\u7ED3\u5C3E\u3002",placeholder:"-----BEGIN PRIVATE KEY-----",disabled:p},"sslKey")]})},{key:"2",label:"\u7533\u8BF7\u8BC1\u4E66",children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(H.Z,{label:"\u90AE\u7BB1",name:"email",placeholder:"\u8BF7\u8F93\u5165\u7533\u8BF7\u7684\u90AE\u7BB1"}),(0,e.jsx)(y.Z,{label:"\u7B7E\u53D1\u670D\u52A1",name:"certServer",initialValue:"letsencrypt",children:(0,e.jsx)(oe.Z,{options:[{value:"letsencrypt",label:"Let's Encrypt"},{value:"zerossl",label:"ZeroSSL"}]})}),(0,e.jsxs)(J.Z,{children:[(0,e.jsx)(T.Z,{span:8,children:(0,e.jsx)(D.Z,{label:"\u81EA\u52A8\u7EED\u7B7E",name:"autoUpgrade",initialValue:!0})}),(0,e.jsx)(T.Z,{span:8,children:(0,e.jsx)(D.Z,{tooltip:"\u901A\u5E38\u60C5\u51B5\u7CFB\u7EDF\u4F1A\u81EA\u52A8\u7EED\u7B7E\uFF0C\u4F60\u4E5F\u53EF\u4EE5\u5F00\u542F\u6B64\u9879\u5F3A\u5236\u7EED\u7B7E",label:"\u7ACB\u5373\u7EED\u7B7E",name:"renew",initialValue:!1})}),(0,e.jsx)(T.Z,{span:8,children:(0,e.jsx)(D.Z,{tooltip:"\u663E\u793A\u5B8C\u6574\u7684\u9519\u8BEF\u4FE1\u606F\uFF0C\u65B9\u4FBF\u6392\u67E5",label:"Debug",name:"debug",initialValue:!1})})]}),(0,e.jsx)(y.Z,{label:"\u63A7\u5236\u53F0\u8F93\u51FA",name:"console",children:(0,e.jsx)(V.ZP,{theme:"dark",style:{marginTop:"10px",backgroundColor:"#282c34"},height:"350px",extensions:[V.tk.lineWrapping]})})]})}]})})}),ce=de,me=t(31199),Ee=t(14726),ve=(0,F.forwardRef)(function(s,l){(0,F.useImperativeHandle)(l,function(){return{showEdit:function(i){U({id:i.id}).then(function(f){var p;(p=r.current)===null||p===void 0||p.setFieldsValue({containerId:s.containerId,serverName:i.serverName,port:i.setting.port,enableBlockCommonExploits:i.setting.enableBlockCommonExploits,enableAssetCache:i.setting.enableAssetCache,enableWs:i.setting.enableWs,extraNginx:i.setting.extraNginx,vhost:f.data.vhost}),c(i.id),o(!0)})}}});var A=(0,F.useState)(!1),n=b()(A,2),C=n[0],o=n[1],r=(0,F.useRef)(),h=(0,F.useState)(0),d=b()(h,2),u=d[0],c=d[1];return(0,e.jsx)(k.a,{drawerProps:{forceRender:!0},open:C,onOpenChange:function(i){o(i)},title:"\u57DF\u540D\u7BA1\u7406",trigger:(0,e.jsx)(Ee.ZP,{onClick:function(){var i;c(0),(i=r.current)===null||i===void 0||i.resetFields()},type:"primary",children:"\u7ED1\u5B9A\u57DF\u540D"}),formRef:r,onFinish:function(){var B=j()(E()().mark(function i(f){var p,R;return E()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,I({id:u,containerId:s.containerId,serverName:f.serverName,port:f.port,enableBlockCommonExploits:f.enableBlockCommonExploits,enableAssetCache:f.enableAssetCache,enableWs:f.enableWs,extraNginx:f.extraNginx});case 2:return R=m.sent,(p=r.current)===null||p===void 0||p.resetFields(),s.onFinish(),m.abrupt("return",!0);case 6:case"end":return m.stop()}},i)}));return function(i){return B.apply(this,arguments)}}(),children:(0,e.jsx)(re.Z,{items:[{key:"1",label:"\u914D\u7F6E\u57DF\u540D",children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(H.Z,{width:"lg",label:"\u57DF\u540D",tooltip:"\u6307\u5B9A\u8981\u7ED1\u5B9A\u7684\u57DF\u540D,\u5E76\u5C06\u8BE5\u57DF\u540D\u89E3\u6790\u5230\u5F53\u524D\u670D\u52A1\u5668",name:"serverName",placeholder:"\u8BF7\u6307\u5B9A\u8981\u7ED1\u5B9A\u7684\u57DF\u540D\uFF0C\u4F8B\u5982 www.explame.com, test.explame.com",rules:[{required:!0}],disabled:u>0}),(0,e.jsx)(me.Z,{label:"\u7AEF\u53E3",name:"port",placeholder:"\u8F6C\u53D1\u5230\u76EE\u6807\u5BB9\u5668\u4E2D\u7684\u7AEF\u53E3\uFF0C\u4E00\u822C\u4E3A80",required:!0,rules:[{required:!0}]}),(0,e.jsxs)(J.Z,{children:[(0,e.jsx)(T.Z,{span:12,children:(0,e.jsx)(D.Z,{label:"\u963B\u6B62\u5E38\u89C1\u6F0F\u6D1E\u5229\u7528",name:"enableBlockCommonExploits"})}),(0,e.jsx)(T.Z,{children:(0,e.jsx)(D.Z,{width:"md",label:"\u9759\u6001\u8D44\u6E90\u7F13\u5B58",name:"enableAssetCache"})})]}),(0,e.jsx)(J.Z,{children:(0,e.jsx)(T.Z,{span:12,children:(0,e.jsx)(D.Z,{label:"\u652F\u6301 Websocket",name:"enableWs"})})}),(0,e.jsx)(y.Z,{name:"extraNginx",label:"\u81EA\u5B9A\u4E49\u6269\u5C55\u914D\u7F6E",tooltip:"\u81EA\u5B9A\u4E49\u6269\u5C55\u7F51\u7AD9 Vhost \u914D\u7F6E\u5185\u5BB9",children:(0,e.jsx)(V.ZP,{height:"300px",theme:"dark",style:{backgroundColor:"#282c34"}})})]})},{key:"2",label:"\u67E5\u770B vhost \u914D\u7F6E",children:(0,e.jsx)(y.Z,{name:"vhost",label:" ",children:(0,e.jsx)(V.ZP,{height:"600px",theme:"dark",readOnly:!0,style:{backgroundColor:"#282c34"}})})}]})})}),he=ve,fe=t(80821),Fe=t(43425),ge=t(12010),ae=t(66309),se=t(78957),Ce=t(96074),pe=t(83062);function xe(){var s=(0,g.useParams)(),l=(0,F.useRef)(),A=(0,F.useRef)(),n=(0,F.useRef)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ce,{ref:n,onFinish:function(){var o;!((o=l.current)===null||o===void 0)&&o.reloadAndRest&&l.current.reloadAndRest()}}),(0,e.jsx)(ge.Z,{rowKey:"id",actionRef:l,columns:[{title:"\u57DF\u540D",dataIndex:"serverName",render:function(o,r,h,d,u){return(0,e.jsx)("a",{href:"".concat(r.setting.enableSSL?"https":"http","://").concat(r.serverName),target:"_blank",children:r.serverName})}},{title:"\u5BB9\u5668\u5185\u7AEF\u53E3",dataIndex:["setting","port"],search:!1},{title:"SSL\u8BC1\u4E66",search:!1,render:function(o,r,h,d,u){var c;return r.setting.enableSSL?(0,e.jsxs)(ae.Z,{color:"success",children:["\u8BC1\u4E66\u6709\u6548\u81F3\uFF1A",new Date((c=r.setting.sslCrtRenewTime)!==null&&c!==void 0?c:"").toLocaleDateString()]}):(0,e.jsx)(ae.Z,{color:"red",children:"\u5426"})}},{title:"\u521B\u5EFA\u65F6\u95F4",search:!1,width:180,ellipsis:!0,dataIndex:"createdAt",render:function(o,r,h,d,u){return new Date(r.createdAt).toLocaleString()}},{title:"\u64CD\u4F5C",valueType:"option",key:"option",width:100,render:function(o,r,h,d){return(0,e.jsxs)(se.Z,{split:(0,e.jsx)(Ce.Z,{type:"vertical"}),children:[(0,e.jsx)(g.Link,{to:"#",onClick:function(){var c;return(c=A.current)===null||c===void 0||c.showEdit(r),!0},children:(0,e.jsx)(pe.Z,{title:"\u7BA1\u7406\u57DF\u540D",children:(0,e.jsx)(Fe.Z,{})})}),(0,e.jsx)(g.Link,{to:"#",onClick:function(){var c;(c=n.current)===null||c===void 0||c.showEdit(r)},children:"SSL"})]})}}],request:function(){var C=j()(E()().mark(function o(r,h,d){var u,c,B,i,f;return E()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,Y({containerId:(u=(c=s.id)!==null&&c!==void 0?c:"")!==null&&u!==void 0?u:"",pageSize:(B=r.pageSize)!==null&&B!==void 0?B:10,page:(i=r.current)!==null&&i!==void 0?i:1,serverName:r.serverName,port:r.port});case 2:return f=R.sent,R.abrupt("return",{data:f.data.list.map(function(S){return S.setting||(S.setting={autoSsl:!1}),S}),success:!0,total:f.data.list.length});case 4:case"end":return R.stop()}},o)}));return function(o,r,h){return C.apply(this,arguments)}}(),toolBarRender:function(){var o;return[(0,e.jsx)(he,{ref:A,containerId:(o=s.id)!==null&&o!==void 0?o:"",onFinish:function(){var h,d;!((h=l.current)===null||h===void 0)&&h.reloadAndRest&&((d=l.current)===null||d===void 0||d.reloadAndRest())}})]},rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},tableAlertOptionRender:function(o){var r=o.selectedRowKeys;return(0,e.jsx)(se.Z,{size:16,children:(0,e.jsx)(fe.Z,{danger:!0,type:"primary",action:function(){return a({id:r})},onSuccess:function(){var d,u;return!((d=l.current)===null||d===void 0)&&d.reloadAndRest&&((u=l.current)===null||u===void 0||u.reloadAndRest()),!0},onError:function(){var d,u;return!((d=l.current)===null||d===void 0)&&d.reset&&((u=l.current)===null||u===void 0||u.reset()),!0},messageSuccess:"\u5220\u9664\u6210\u529F",children:"\u6279\u91CF\u5220\u9664"})})},pagination:{pageSize:10}})]})}}}]);
