"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7745],{16664:function(K,b,e){e.d(b,{Z:function(){return y}});var Z=e(87462),g=e(62435),I={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"unordered-list",theme:"outlined"},s=I,a=e(84089),v=function(M,p){return g.createElement(a.Z,(0,Z.Z)({},M,{ref:p,icon:s}))},h=g.forwardRef(v),y=h},20387:function(K,b,e){e.r(b),e.d(b,{default:function(){return ae}});var Z=e(15009),g=e.n(Z),I=e(99289),s=e.n(I),a=e(5574),v=e.n(a),h=e(19632),y=e.n(h),C=e(97857),M=e.n(C),p=e(62435),J=e(48031),U=function(){return U=Object.assign||function(n){for(var u,f=1,i=arguments.length;f<i;f++){u=arguments[f];for(var r in u)Object.prototype.hasOwnProperty.call(u,r)&&(n[r]=u[r])}return n},U.apply(this,arguments)},Q=function(n){return p.createElement(J.P,U({},n,{chartType:"Area"}))},V=Q,o=e(86074);function O(n){var u={theme:"academy",xField:n.xField,yField:n.yField,height:200,axis:{y:{line:!0,grid:{visable:!0}},x:{line:!0,grid:{visable:!0}}},data:n.data};return n.yDomain&&(u.scale={y:{domain:n.yDomain}}),n.colorField&&(u.colorField=n.colorField),(0,o.jsx)(V,M()({},u))}function W(n){var u=n.reqFunction,f=n.interval,i=n.maxPolling,r=n.pollingStatus,D=(0,p.useRef)(null),H=0,z=function A(){D.current=window.setTimeout(s()(g()().mark(function Y(){var B;return g()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!(H++>=i)){d.next=3;break}return F(),d.abrupt("return");case 3:return d.prev=3,d.next=6,u();case 6:B=d.sent,A(),d.next=14;break;case 10:d.prev=10,d.t0=d.catch(3),F(),console.error("\u8F6E\u8BE2\u53D1\u751F\u9519\u8BEF\uFF1A",d.t0);case 14:case"end":return d.stop()}},Y,null,[[3,10]])})),f)},F=function(){console.log("end polling"),D.current&&window.clearTimeout(D.current)};return(0,p.useEffect)(function(){return console.log((r?"start":"waiting")+" polling, max "+i),r&&z(),F},[f,i,r]),{endPolling:F}}var X=W,k=e(54006);function N(n){return $.apply(this,arguments)}function $(){return $=s()(g()().mark(function n(u){return g()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",(0,k.request)("/api/app/container/get-stat-info",{method:"POST",data:u}));case 1:case"end":return i.stop()}},n)})),$.apply(this,arguments)}function q(n){return E.apply(this,arguments)}function E(){return E=s()(g()().mark(function n(u){return g()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",(0,k.request)("/api/app/container/get-process-info",{method:"POST",data:u}));case 1:case"end":return i.stop()}},n)})),E.apply(this,arguments)}var P=e(5251),R=e(12122),_=e(16664),T=e(38345),ee=e(63490),j=new Date().toLocaleTimeString(),te={total:0,memory:[{date:j,usage:0,source:{usage:0,limit:0}}],cpu:[{date:j,usage:0}],network:[{usage:0,type:"rx",date:j,source:{usage:0}},{usage:0,type:"tx",date:j,source:{usage:0}}],io:[{usage:0,type:"read",date:j,source:{usage:0}},{usage:0,type:"write",date:j,source:{usage:0}}]};function ae(){var n=function(m,t){switch(t.type){case"update":var c=new Date(t.payload.read).toLocaleTimeString(),l=t.payload.cpu_stats.cpu_usage.total_usage-t.payload.precpu_stats.cpu_usage.total_usage,G=t.payload.cpu_stats.system_cpu_usage-t.payload.precpu_stats.system_cpu_usage,S=0,re=0;return t.payload.blkio_stats.io_service_bytes_recursive.map(function(L){L.op=="read"&&(S=L.value),L.op=="write"&&(re=L.value)}),{total:m.total+1,memory:[].concat(y()(m.memory),[{date:c,usage:Math.round(t.payload.memory_stats.usage/1024/1024),source:{usage:t.payload.memory_stats.usage,limit:t.payload.memory_stats.limit}}]),cpu:[].concat(y()(m.cpu),[{date:c,usage:l/G*t.payload.cpu_stats.online_cpus*100}]),io:[].concat(y()(m.io),[{date:c,usage:parseFloat((t.payload.blkio_stats.io_service_bytes_recursive[0].value/1024/1024).toFixed(2)),type:t.payload.blkio_stats.io_service_bytes_recursive[0].op,source:{usage:t.payload.blkio_stats.io_service_bytes_recursive[0].value}},{date:c,usage:parseFloat((t.payload.blkio_stats.io_service_bytes_recursive[1].value/1024/1024).toFixed(2)),type:t.payload.blkio_stats.io_service_bytes_recursive[1].op,source:{usage:t.payload.blkio_stats.io_service_bytes_recursive[1].value}}]),network:[].concat(y()(m.network),[{date:c,usage:parseFloat((t.payload.networks.eth0.rx_bytes/1024).toFixed(2)),type:"rx",source:{usage:t.payload.networks.eth0.rx_bytes}},{date:c,usage:parseFloat((t.payload.networks.eth0.tx_bytes/1024).toFixed(2)),type:"tx",source:{usage:t.payload.networks.eth0.tx_bytes}}])}}},u=(0,k.useParams)(),f=(0,p.useReducer)(n,te),i=v()(f,2),r=i[0],D=i[1],H=(0,p.useState)([]),z=v()(H,2),F=z[0],A=z[1],Y=(0,p.useState)(),B=v()(Y,2),x=B[0],d=B[1],ne=X({reqFunction:function(){var w=s()(g()().mark(function t(){var c,l;return g()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,N({id:(c=u.id)!==null&&c!==void 0?c:""});case 2:l=S.sent,D({type:"update",payload:l});case 4:case"end":return S.stop()}},t)}));function m(){return w.apply(this,arguments)}return m}(),interval:3e3,maxPolling:999,pollingStatus:F.length!=0});return(0,p.useEffect)(function(){var w,m;N({id:(w=u.id)!==null&&w!==void 0?w:""}).then(function(t){return A([0,Math.round(t.memory_stats.limit/1024/1024)]),!0}),q({id:(m=u.id)!==null&&m!==void 0?m:""}).then(function(t){var c={columns:[],data:[]};t.data.list.Titles.map(function(l){c.columns.push({title:l,label:l,dataIndex:l})}),t.data.list.Processes.map(function(l,G){c.data.push({UID:l[0],PID:l[1],PPID:l[2],C:l[3],STIME:l[4],TTY:l[5],TIME:l[6],CMD:l[7]})}),d(c)})},[]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(T.Z,{direction:"row",wrap:!0,gutter:[20,20],children:[(0,o.jsx)(T.Z,{colSpan:12,title:(0,o.jsx)(R.Z,{}),subTitle:"Memory usage: ".concat((0,P.FI)(r.memory[r.memory.length-1].source.usage)," / ").concat((0,P.FI)(r.memory[r.memory.length-1].source.limit)),headerBordered:!0,bordered:!0,children:(0,o.jsx)(O,{yField:"usage",xField:"date",data:r.memory,yDomain:F})}),(0,o.jsx)(T.Z,{colSpan:12,title:(0,o.jsx)(R.Z,{}),subTitle:"Cpu usage: ".concat(r.cpu[r.cpu.length-1].usage.toFixed(2),"%"),headerBordered:!0,bordered:!0,children:(0,o.jsx)(O,{yField:"usage",xField:"date",data:r.cpu})}),(0,o.jsx)(T.Z,{colSpan:12,title:(0,o.jsx)(R.Z,{}),subTitle:"I/O: ".concat((0,P.FI)(r.io[r.io.length-1].source.usage)," / ").concat((0,P.FI)(r.io[r.io.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,o.jsx)(O,{yField:"usage",xField:"date",colorField:"type",data:r.io})}),(0,o.jsx)(T.Z,{colSpan:12,title:(0,o.jsx)(R.Z,{}),subTitle:"Network: ".concat((0,P.FI)(r.network[r.io.length-1].source.usage)," / ").concat((0,P.FI)(r.network[r.io.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,o.jsx)(O,{yField:"usage",xField:"date",colorField:"type",data:r.network})})]}),(0,o.jsx)(T.Z,{title:(0,o.jsx)(_.Z,{}),subTitle:"Progress",children:(0,o.jsx)(ee.Z,{rowKey:"PID",columns:x==null?void 0:x.columns,dataSource:x==null?void 0:x.data,pagination:{pageSize:10}})})]})}},5251:function(K,b,e){e.d(b,{FI:function(){return g},ZM:function(){return I}});function Z(s){return s.trim()}function g(s){var a="";s<.1*1024?a=s.toFixed(2)+"B":s<.1*1024*1024?a=(s/1024).toFixed(2)+"KB":s<1*1024*1024*1024?a=(s/(1024*1024)).toFixed(2)+"MB":a=(s/(1024*1024*1024)).toFixed(2)+"GB";var v=a+"",h=v.indexOf("."),y=v.substr(h+1,2);return y=="00"?v.substring(0,h)+v.substr(h+3,2):a}function I(s){if(s){var a=new Date(s),v=a.getFullYear()+"-",h=(a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1)+"-",y=(a.getDate()<10?"0"+a.getDate():a.getDate())+" ",C=(a.getHours()<10?"0"+a.getHours():a.getHours())+":",M=(a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes())+":",p=a.getSeconds()<10?"0"+a.getSeconds():a.getSeconds();return v+h+y+C+M+p}}}}]);
