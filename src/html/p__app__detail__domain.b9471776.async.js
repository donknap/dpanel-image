"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3146],{80821:function(oe,V,u){u.d(V,{Z:function(){return M}});var J=u(5574),c=u.n(J),z=u(93246),B=u(54006),Q=u(31418),y=u(86738),p=u(14726),X=u(83062),L=u(62435),I=u(86074);function M(a){var W=(0,L.useState)(!1),G=c()(W,2),w=G[0],k=G[1],O=Q.Z.useApp(),q=(0,B.useIntl)(),$=function(){k(!0),a.action().then(function(U){if(k(!1),typeof a.onSuccess=="function"&&a.onSuccess(U),a.messageSuccess){var j="";a.messageSuccess.indexOf(".")>-1?j=q.formatMessage({id:a.messageSuccess}):j=a.messageSuccess,a.asynced?(0,z.Rk)(O,j):(0,z.$h)(O,j)}}).catch(function(U){k(!1),typeof a.onError=="function"&&a.onError(U)})};return a.confirm?(0,I.jsx)(y.Z,{style:{width:500},title:"\u63D0\u793A",description:a.confirm,onConfirm:$,okText:"Yes",cancelText:"No",children:(0,I.jsx)(p.ZP,{disabled:a.disabled,icon:a.icon,loading:w,danger:a.danger,type:a.type,children:a.children})}):(0,I.jsx)(X.Z,{title:a.tips,children:(0,I.jsx)(p.ZP,{disabled:a.disabled,icon:a.icon,loading:w,onClick:$,danger:a.danger,type:a.type,children:a.children})})}},71457:function(oe,V,u){u.r(V),u.d(V,{default:function(){return Ae}});var J=u(15009),c=u.n(J),z=u(99289),B=u.n(z),Q=u(5574),y=u.n(Q),p=u(54006);function X(r){return L.apply(this,arguments)}function L(){return L=B()(c()().mark(function r(s){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,p.request)("/api/app/site/get-domain-list",{method:"POST",data:s}));case 1:case"end":return n.stop()}},r)})),L.apply(this,arguments)}function I(r){return M.apply(this,arguments)}function M(){return M=B()(c()().mark(function r(s){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,p.request)("/api/app/site/create-domain",{method:"POST",data:s}));case 1:case"end":return n.stop()}},r)})),M.apply(this,arguments)}function a(r){return W.apply(this,arguments)}function W(){return W=B()(c()().mark(function r(s){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,p.request)("/api/app/site/update-domain",{method:"POST",data:s}));case 1:case"end":return n.stop()}},r)})),W.apply(this,arguments)}function G(r){return w.apply(this,arguments)}function w(){return w=B()(c()().mark(function r(s){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,p.request)("/api/app/site/delete-domain",{method:"POST",data:s}));case 1:case"end":return n.stop()}},r)})),w.apply(this,arguments)}function k(r){return O.apply(this,arguments)}function O(){return O=B()(c()().mark(function r(s){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,p.request)("/api/app/site/get-domain-detail",{method:"POST",data:s}));case 1:case"end":return n.stop()}},r)})),O.apply(this,arguments)}function q(r){return $.apply(this,arguments)}function $(){return $=B()(c()().mark(function r(s){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,p.request)("/api/app/site/apply-domain-cert",{method:"POST",data:s}));case 1:case"end":return n.stop()}},r)})),$.apply(this,arguments)}var _=u(184),U=u(50335),j=u(90672),ae=u(5966),Y=u(62370),K=u(52688),se=u(92398),de=u(38925),ce=u(34041),ee=u(71230),N=u(15746),f=u(62435),H=u(20713),e=u(86074),ue="",me=(0,f.forwardRef)(function(r,s){var x=(0,f.useState)(!1),n=y()(x,2),D=n[0],o=n[1],t=(0,f.useRef)(),v=(0,f.useState)(),d=y()(v,2),l=d[0],m=d[1],S=(0,p.useModel)("subscriber"),i=(0,f.useState)(!1),E=y()(i,2),C=E[0],R=E[1],b=(0,f.useState)("1"),ne=y()(b,2),g=ne[0],Be=ne[1];return(0,f.useImperativeHandle)(s,function(){return{showEdit:function(h){var F,T;if((F=t.current)===null||F===void 0||F.setFieldsValue({sslCrt:h.setting.sslCrt,sslKey:h.setting.sslKey,email:(T=localStorage.getItem("email"))!==null&&T!==void 0?T:"",console:""}),h.setting.sslCrtRenewTime){var P;(P=t.current)===null||P===void 0||P.setFieldValue("sslCrtRenewTime",h.setting.sslCrtRenewTime)}h.setting.autoSsl?R(!0):R(!1),ue="",m(h),o(!0)}}}),S.addDataHandler("composeUp",function(){var Z=S.getDataByType("composeUp");if(Z){var h;Z.map(function(F){ue+=F.data}),(h=t.current)===null||h===void 0||h.setFieldValue("console",ue)}}),(0,e.jsx)(_.a,{drawerProps:{forceRender:!0},formRef:t,onFinish:function(){var Z=B()(c()().mark(function h(F){var T,P,te,re,Se,Re;return c()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(l){A.next=2;break}return A.abrupt("return",!0);case 2:if(g!="1"){A.next=7;break}return A.next=5,a({id:l.id,sslCrt:(T=F.sslCrt)!==null&&T!==void 0?T:"",sslKey:(P=F.sslKey)!==null&&P!==void 0?P:"",sslCrtRenewTime:(te=F.sslCrtRenewTime)!==null&&te!==void 0?te:""});case 5:Se=A.sent,(re=t.current)===null||re===void 0||re.resetFields();case 7:if(g!="2"){A.next=12;break}return localStorage.setItem("email",F.email),A.next=11,q({id:l.id,email:F.email,certServer:F.certServer,autoUpgrade:F.autoUpgrade,renew:F.renew,debug:F.debug});case 11:Re=A.sent;case 12:return r.onFinish&&r.onFinish(),A.abrupt("return",!0);case 14:case"end":return A.stop()}},h)}));return function(h){return Z.apply(this,arguments)}}(),onOpenChange:function(h){o(h)},open:D,children:(0,e.jsx)(se.Z,{onChange:function(h){Be(h)},items:[{key:"1",label:"\u624B\u52A8\u4E0A\u4F20\u8BC1\u4E66",children:(0,e.jsxs)(e.Fragment,{children:[C&&(0,e.jsx)(de.Z,{message:"\u5F53\u524D\u8BC1\u4E66\u4E3A\u81EA\u52A8\u7B7E\u53D1\uFF0C\u8BF7\u52FF\u4FEE\u6539\u3002\u8BC1\u4E66\u8DEF\u5F84\u4E3A\uFF1A/dpanel/cert \u76EE\u5F55",style:{margin:"15px 0"}}),(0,e.jsx)(U.Z,{label:"\u8BC1\u4E66\u5230\u671F\u65F6\u95F4",name:"sslCrtRenewTime",width:"lg",required:!0,disabled:C}),(0,e.jsx)(j.Z,{fieldProps:{autoSize:{minRows:10}},label:"\u8BC1\u4E66\u5185\u5BB9 .crt ",name:"sslCrt",tooltip:"1.\u901A\u5E38\u8BC1\u4E66\u662F\u4EE5 .crt \u6216 .pem \u7B49\u4E3A\u6269\u5C55\u540D\u7684\u6587\u4EF6\uFF0C\u8BF7\u4F7F\u7528\u76F8\u5E94\u6587\u672C\u7F16\u8F91\u5668\u6253\u5F00\u8BC1\u4E66\u6587\u4EF6\u3002 2.\u8BC1\u4E66\u683C\u5F0F\u4EE5\u201C-----BEGIN CERTIFICATE-----\u201D\u5F00\u5934\uFF0C\u4EE5\u201C-----END CERTIFICATE-----\u201D\u7ED3\u5C3E\u3002 3.\u8BC1\u4E66\u5185\u5BB9\u8BF7\u5305\u542B\u5B8C\u6574\u7684\u8BC1\u4E66\u94FE\u3002",placeholder:"-----BEGIN CERTIFICATE-----",disabled:C,required:!0},"sslCrt"),(0,e.jsx)(j.Z,{fieldProps:{autoSize:{minRows:10}},label:"\u79C1\u94A5\u5185\u5BB9 .key ",name:"sslKey",tooltip:"1.\u901A\u5E38\u79C1\u94A5\u662F\u4EE5 .key \u6216 .pem \u7B49\u4E3A\u6269\u5C55\u540D\u7684\u6587\u4EF6\uFF0C\u8BF7\u4F7F\u7528\u76F8\u5E94\u6587\u672C\u7F16\u8F91\u5668\u6253\u5F00\u79C1\u94A5\u6587\u4EF6\u3002 2.\u79C1\u94A5\u683C\u5F0F\u4EE5\u201C-----BEGIN PRIVATE KEY-----\u201D\u5F00\u5934\uFF0C\u4EE5\u201C-----END PRIVATE KEY-----\u201D\u7ED3\u5C3E\u3002",placeholder:"-----BEGIN PRIVATE KEY-----",disabled:C,required:!0},"sslKey")]})},{key:"2",label:"\u7533\u8BF7\u8BC1\u4E66",children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ae.Z,{label:"\u90AE\u7BB1",name:"email",placeholder:"\u8BF7\u8F93\u5165\u7533\u8BF7\u7684\u90AE\u7BB1"}),(0,e.jsx)(Y.Z,{label:"\u7B7E\u53D1\u670D\u52A1",name:"certServer",initialValue:"letsencrypt",children:(0,e.jsx)(ce.Z,{options:[{value:"letsencrypt",label:"Let's Encrypt"},{value:"zerossl",label:"ZeroSSL"}]})}),(0,e.jsxs)(ee.Z,{children:[(0,e.jsx)(N.Z,{span:8,children:(0,e.jsx)(K.Z,{label:"\u81EA\u52A8\u7EED\u7B7E",name:"autoUpgrade",initialValue:!0})}),(0,e.jsx)(N.Z,{span:8,children:(0,e.jsx)(K.Z,{tooltip:"\u901A\u5E38\u60C5\u51B5\u7CFB\u7EDF\u4F1A\u81EA\u52A8\u7EED\u7B7E\uFF0C\u4F60\u4E5F\u53EF\u4EE5\u5F00\u542F\u6B64\u9879\u5F3A\u5236\u7EED\u7B7E",label:"\u7ACB\u5373\u7EED\u7B7E",name:"renew",initialValue:!1})}),(0,e.jsx)(N.Z,{span:8,children:(0,e.jsx)(K.Z,{tooltip:"\u663E\u793A\u5B8C\u6574\u7684\u9519\u8BEF\u4FE1\u606F\uFF0C\u65B9\u4FBF\u6392\u67E5",label:"Debug",name:"debug",initialValue:!1})})]}),(0,e.jsx)(Y.Z,{label:"\u63A7\u5236\u53F0\u8F93\u51FA",name:"console",children:(0,e.jsx)(H.ZP,{theme:"dark",style:{marginTop:"10px",backgroundColor:"#282c34"},height:"350px",extensions:[H.tk.lineWrapping]})})]})}]})})}),Ee=me,he=u(31199),ve=u(14726),fe=(0,f.forwardRef)(function(r,s){(0,f.useImperativeHandle)(s,function(){return{showEdit:function(i){k({id:i.id}).then(function(E){var C;(C=t.current)===null||C===void 0||C.setFieldsValue({containerId:r.containerId,serverName:i.serverName,port:i.setting.port,enableBlockCommonExploits:i.setting.enableBlockCommonExploits,enableAssetCache:i.setting.enableAssetCache,enableWs:i.setting.enableWs,extraNginx:i.setting.extraNginx,vhost:E.data.vhost}),m(i.id),o(!0)})}}});var x=(0,f.useState)(!1),n=y()(x,2),D=n[0],o=n[1],t=(0,f.useRef)(),v=(0,f.useState)(0),d=y()(v,2),l=d[0],m=d[1];return(0,e.jsx)(_.a,{drawerProps:{forceRender:!0},open:D,onOpenChange:function(i){o(i)},title:"\u57DF\u540D\u7BA1\u7406",trigger:(0,e.jsx)(ve.ZP,{onClick:function(){var i;m(0),(i=t.current)===null||i===void 0||i.resetFields()},type:"primary",children:"\u7ED1\u5B9A\u57DF\u540D"}),formRef:t,onFinish:function(){var S=B()(c()().mark(function i(E){var C,R,b;return c()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(l>0)){g.next=6;break}return g.next=3,a({id:l,port:E.port,enableBlockCommonExploits:E.enableBlockCommonExploits,enableAssetCache:E.enableAssetCache,enableWs:E.enableWs,extraNginx:E.extraNginx});case 3:R=g.sent,g.next=9;break;case 6:return g.next=8,I({containerId:r.containerId,serverName:E.serverName,port:E.port,enableBlockCommonExploits:E.enableBlockCommonExploits,enableAssetCache:E.enableAssetCache,enableWs:E.enableWs,extraNginx:E.extraNginx});case 8:b=g.sent;case 9:return(C=t.current)===null||C===void 0||C.resetFields(),r.onFinish(),g.abrupt("return",!0);case 12:case"end":return g.stop()}},i)}));return function(i){return S.apply(this,arguments)}}(),children:(0,e.jsx)(se.Z,{items:[{key:"1",label:"\u914D\u7F6E\u57DF\u540D",children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ae.Z,{width:"lg",label:"\u57DF\u540D",tooltip:"\u6307\u5B9A\u8981\u7ED1\u5B9A\u7684\u57DF\u540D,\u5E76\u5C06\u8BE5\u57DF\u540D\u89E3\u6790\u5230\u5F53\u524D\u670D\u52A1\u5668",name:"serverName",placeholder:"\u8BF7\u6307\u5B9A\u8981\u7ED1\u5B9A\u7684\u57DF\u540D\uFF0C\u4F8B\u5982 www.explame.com, test.explame.com",rules:[{required:!0}],disabled:l>0}),(0,e.jsx)(he.Z,{label:"\u7AEF\u53E3",name:"port",placeholder:"\u8F6C\u53D1\u5230\u76EE\u6807\u5BB9\u5668\u4E2D\u7684\u7AEF\u53E3\uFF0C\u4E00\u822C\u4E3A80",required:!0,rules:[{required:!0}]}),(0,e.jsxs)(ee.Z,{children:[(0,e.jsx)(N.Z,{span:12,children:(0,e.jsx)(K.Z,{label:"\u963B\u6B62\u5E38\u89C1\u6F0F\u6D1E\u5229\u7528",name:"enableBlockCommonExploits"})}),(0,e.jsx)(N.Z,{children:(0,e.jsx)(K.Z,{width:"md",label:"\u9759\u6001\u8D44\u6E90\u7F13\u5B58",name:"enableAssetCache"})})]}),(0,e.jsx)(ee.Z,{children:(0,e.jsx)(N.Z,{span:12,children:(0,e.jsx)(K.Z,{label:"\u652F\u6301 Websocket",name:"enableWs"})})}),(0,e.jsx)(Y.Z,{name:"extraNginx",label:"\u81EA\u5B9A\u4E49\u6269\u5C55\u914D\u7F6E",tooltip:"\u81EA\u5B9A\u4E49\u6269\u5C55\u7F51\u7AD9 Vhost \u914D\u7F6E\u5185\u5BB9",children:(0,e.jsx)(H.ZP,{height:"300px",theme:"dark",style:{backgroundColor:"#282c34"}})})]})},{key:"2",label:"\u67E5\u770B vhost \u914D\u7F6E",children:(0,e.jsx)(Y.Z,{name:"vhost",label:" ",children:(0,e.jsx)(H.ZP,{height:"600px",theme:"dark",readOnly:!0,style:{backgroundColor:"#282c34"}})})}]})})}),Fe=fe,pe=u(80821),Ce=u(43425),ge=u(12010),le=u(66309),ie=u(78957),xe=u(96074),De=u(83062);function Ae(){var r=(0,p.useParams)(),s=(0,f.useRef)(),x=(0,f.useRef)(),n=(0,f.useRef)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ee,{ref:n,onFinish:function(){var o;!((o=s.current)===null||o===void 0)&&o.reloadAndRest&&s.current.reloadAndRest()}}),(0,e.jsx)(ge.Z,{rowKey:"id",actionRef:s,columns:[{title:"\u57DF\u540D",dataIndex:"serverName",render:function(o,t,v,d,l){return(0,e.jsx)("a",{href:"".concat(t.setting.enableSSL?"https":"http","://").concat(t.serverName),target:"_blank",children:t.serverName})}},{title:"\u5BB9\u5668\u5185\u7AEF\u53E3",dataIndex:["setting","port"],search:!1},{title:"SSL\u8BC1\u4E66",search:!1,render:function(o,t,v,d,l){var m;return t.setting.enableSSL?(0,e.jsxs)(le.Z,{color:"success",children:["\u8BC1\u4E66\u6709\u6548\u81F3\uFF1A",new Date((m=t.setting.sslCrtRenewTime)!==null&&m!==void 0?m:"").toLocaleDateString()]}):(0,e.jsx)(le.Z,{color:"red",children:"\u5426"})}},{title:"\u521B\u5EFA\u65F6\u95F4",search:!1,width:180,ellipsis:!0,dataIndex:"createdAt",render:function(o,t,v,d,l){return new Date(t.createdAt).toLocaleString()}},{title:"\u64CD\u4F5C",valueType:"option",key:"option",width:100,render:function(o,t,v,d){return(0,e.jsxs)(ie.Z,{split:(0,e.jsx)(xe.Z,{type:"vertical"}),children:[(0,e.jsx)(p.Link,{to:"#",onClick:function(){var m;return(m=x.current)===null||m===void 0||m.showEdit(t),!0},children:(0,e.jsx)(De.Z,{title:"\u7BA1\u7406\u57DF\u540D",children:(0,e.jsx)(Ce.Z,{})})}),(0,e.jsx)(p.Link,{to:"#",onClick:function(){var m;(m=n.current)===null||m===void 0||m.showEdit(t)},children:"SSL"})]})}}],request:function(){var D=B()(c()().mark(function o(t,v,d){var l,m,S,i,E;return c()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,X({containerId:(l=(m=r.id)!==null&&m!==void 0?m:"")!==null&&l!==void 0?l:"",pageSize:(S=t.pageSize)!==null&&S!==void 0?S:10,page:(i=t.current)!==null&&i!==void 0?i:1,serverName:t.serverName,port:t.port});case 2:return E=R.sent,R.abrupt("return",{data:E.data.list.map(function(b){return b.setting||(b.setting={autoSsl:!1}),b}),success:!0,total:E.data.list.length});case 4:case"end":return R.stop()}},o)}));return function(o,t,v){return D.apply(this,arguments)}}(),toolBarRender:function(){var o;return[(0,e.jsx)(Fe,{ref:x,containerId:(o=r.id)!==null&&o!==void 0?o:"",onFinish:function(){var v,d;!((v=s.current)===null||v===void 0)&&v.reloadAndRest&&((d=s.current)===null||d===void 0||d.reloadAndRest())}})]},rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},tableAlertOptionRender:function(o){var t=o.selectedRowKeys;return(0,e.jsx)(ie.Z,{size:16,children:(0,e.jsx)(pe.Z,{danger:!0,type:"primary",action:function(){return G({id:t})},onSuccess:function(){var d,l;return!((d=s.current)===null||d===void 0)&&d.reloadAndRest&&((l=s.current)===null||l===void 0||l.reloadAndRest()),!0},onError:function(){var d,l;return!((d=s.current)===null||d===void 0)&&d.reset&&((l=s.current)===null||l===void 0||l.reset()),!0},messageSuccess:"\u5220\u9664\u6210\u529F",children:"\u6279\u91CF\u5220\u9664"})})},pagination:{pageSize:10}})]})}}}]);
